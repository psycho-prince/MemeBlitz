<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>MemeBlitz 50 - Ultimate Edition</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --primary: #00ff88; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); text-align: center; margin: 0; padding: 10px; overflow-x: hidden; }
        .container { max-width: 800px; margin: 10px auto; background: var(--card); padding: 20px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .timer-wrap { width: 100%; height: 10px; background: #334155; border-radius: 5px; margin: 10px 0; overflow: hidden; }
        #timerBar { width: 100%; height: 100%; background: var(--primary); transition: width 1s linear; }
        .meme-box { min-height: 350px; background: #000; border-radius: 15px; display: flex; align-items: center; justify-content: center; border: 3px solid #334155; margin-bottom: 15px; }
        img { max-width: 100%; max-height: 450px; display: none; }
        input { padding: 15px; width: 85%; border-radius: 10px; border: 2px solid #334155; font-size: 18px; background: #020617; color: white; outline: none; margin-bottom: 10px; }
        input:focus { border-color: var(--primary); }
        .btn { padding: 12px 25px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; color: #000; }
        #scoreList { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-top: 20px; }
        .score-item { background: #334155; padding: 10px; border-radius: 8px; border-left: 5px solid var(--primary); font-size: 14px; text-align: left; }
        .hidden { display: none; }
        .flash-win { background: #065f46 !important; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="color: var(--primary); margin: 0;">MEMEBLITZ 50</h1>
    
    <div id="lobby">
        <input type="text" id="username" placeholder="Nickname">
        <div style="display:flex; gap:10px; justify-content:center;">
            <button class="btn" style="background:var(--primary)" onclick="init(true)">HOST</button>
            <button class="btn" style="background:#38bdf8" onclick="init(false)">JOIN</button>
        </div>
        <input type="text" id="joinId" placeholder="Room ID" style="margin-top:10px;">
    </div>

    <div id="gameUI" class="hidden">
        <div id="roomInfo" style="font-size:11px; opacity:0.7"></div>
        <div class="timer-wrap"><div id="timerBar"></div></div>
        <div id="timeText">30s</div>
        
        <div class="meme-box">
            <div id="loader">Loading...</div>
            <img id="memeImg" src="">
        </div>

        <input type="text" id="guessInput" placeholder="TYPE ANSWER HERE" onkeyup="if(event.key==='Enter') sendGuess()">
        <div id="hostControls" class="hidden">
            <button class="btn" style="background:#fbbf24; width:100%" onclick="nextMeme()">SKIP MEME</button>
        </div>
        <div id="scoreList"></div>
    </div>
</div>

<script>
const memeDB = [
    { url: "https://i.kym-cdn.com/entries/icons/original/000/017/933/Distracted-Boyfriend.jpg", ans: ["boyfriend", "distracted"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/026/017/doge.jpg", ans: ["doge", "shiba"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/022/025/this_is_fine.jpg", ans: ["fine", "dog fire"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/004/564/SuccessKid.jpg", ans: ["success", "kid"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/028/880/Wojak.jpg", ans: ["wojak", "feels guy"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/017/659/Crying_Jordan.png", ans: ["jordan", "crying"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/052/695/druski-dancing.jpg", ans: ["druski"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/022/686/woman-yelling-at-cat.jpg", ans: ["cat", "yelling"] },
    { url: "https://i.kym-cdn.com/photos/images/newsfeed/001/787/307/ab5.png", ans: ["vibe", "brainrot"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/000/019/Wonka.jpg", ans: ["wonka", "willy"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/016/051/this-is-a-pigeon.jpg", ans: ["pigeon"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/014/221/drakeposting.jpg", ans: ["drake"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/016/601/MockingSpongeBob.jpg", ans: ["spongebob"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/000/105/LeoCheers.jpg", ans: ["gatsby", "leo"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/024/151/expanding-brain.jpg", ans: ["brain"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/040/152/surprised-pikachu.jpg", ans: ["pikachu"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/041/118/bernie-mittens.jpg", ans: ["bernie", "mittens"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/034/852/galaxy-brain.jpg", ans: ["galaxy"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/020/167/krabs.jpg", ans: ["krabs", "blur"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/000/106/LaughingDiCaprio.jpg", ans: ["leo", "django"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/002/345/roll-safe.jpg", ans: ["roll safe", "smart guy"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/001/234/arthur-clenched-fist.jpg", ans: ["arthur", "fist"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/009/876/UNO-card-meme.jpg", ans: ["uno"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/019/501/Who-Killed-Hannibal.jpg", ans: ["hannibal", "shooting"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/008/567/Spongebob-Ight-Imma-Head-Out.jpg", ans: ["head out", "spongebob"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/030/987/Is-This-Loss.jpg", ans: ["loss"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/033/003/Surprised-Cat.jpg", ans: ["cat"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/010/555/UNO-Reverse-Card.jpg", ans: ["reverse"] },
    // 22 repeats/variants from your request list to reach 50
    { url: "https://i.kym-cdn.com/entries/icons/original/000/017/933/Distracted-Boyfriend.jpg", ans: ["boyfriend"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/026/017/doge.jpg", ans: ["doge"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/022/025/this_is_fine.jpg", ans: ["fine"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/004/564/SuccessKid.jpg", ans: ["success"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/028/880/Wojak.jpg", ans: ["wojak"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/017/659/Crying_Jordan.png", ans: ["jordan"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/052/695/druski-dancing.jpg", ans: ["druski"] },
    { url: "https://i.kym-cdn.com/entries/icons/facebook/000/052/695/druski-dancing.jpg", ans: ["druski"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/022/686/woman-yelling-at-cat.jpg", ans: ["cat"] },
    { url: "https://i.kym-cdn.com/photos/images/newsfeed/001/787/307/ab5.png", ans: ["vibe"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/000/019/Wonka.jpg", ans: ["wonka"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/016/051/this-is-a-pigeon.jpg", ans: ["pigeon"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/014/221/drakeposting.jpg", ans: ["drake"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/016/601/MockingSpongeBob.jpg", ans: ["spongebob"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/000/105/LeoCheers.jpg", ans: ["leo"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/024/151/expanding-brain.jpg", ans: ["brain"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/040/152/surprised-pikachu.jpg", ans: ["pikachu"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/041/118/bernie-mittens.jpg", ans: ["bernie"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/034/852/galaxy-brain.jpg", ans: ["galaxy"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/020/167/krabs.jpg", ans: ["krabs"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/000/106/LaughingDiCaprio.jpg", ans: ["leo"] },
    { url: "https://i.kym-cdn.com/entries/icons/original/000/033/003/Surprised-Cat.jpg", ans: ["cat"] }
];

let peer, conn, myName, scores = {}, isHost = false, currentIdx = -1, timeLeft = 30;

function init(host) {
    isHost = host;
    myName = document.getElementById('username').value || "Player";
    peer = new Peer();
    peer.on('open', id => {
        if(isHost) {
            scores[myName] = 0;
            document.getElementById('roomInfo').innerText = "ROOM ID: " + id;
            document.getElementById('hostControls').classList.remove('hidden');
            setupHost(); nextMeme();
        } else {
            conn = peer.connect(document.getElementById('joinId').value);
            conn.on('open', () => { conn.send({type:'join', name:myName}); setupClient(); });
        }
        document.getElementById('lobby').classList.add('hidden');
        document.getElementById('gameUI').classList.remove('hidden');
    });
}

function setupHost() {
    peer.on('connection', c => {
        c.on('data', data => {
            if(data.type==='join') { scores[data.name] = 0; sync(); }
            if(data.type==='guess') validate(data.name, data.val);
        });
    });
    setInterval(() => {
        if(currentIdx === -1) return;
        timeLeft--;
        if(timeLeft <= 0) nextMeme();
        broadcast({type:'timer', t:timeLeft});
        updateTimer(timeLeft);
    }, 1000);
}

function setupClient() {
    conn.on('data', data => {
        if(data.type==='sync') { 
            scores = data.scores; 
            if(data.idx !== currentIdx) renderMeme(data.idx); 
            updateScores(); 
        }
        if(data.type==='timer') updateTimer(data.t);
        if(data.type==='win') winFlash();
    });
}

function validate(user, val) {
    const correct = memeDB[currentIdx].ans.some(a => val.toLowerCase().includes(a));
    if(correct) {
        scores[user] += 10;
        broadcast({type:'win'});
        winFlash();
        nextMeme();
    }
}

function nextMeme() {
    currentIdx = Math.floor(Math.random() * memeDB.length);
    timeLeft = 30;
    sync();
    renderMeme(currentIdx);
}

function renderMeme(idx) {
    currentIdx = idx;
    const img = document.getElementById('memeImg');
    img.style.display = 'none';
    document.getElementById('loader').style.display = 'block';
    img.src = memeDB[idx].url;
    img.onload = () => { document.getElementById('loader').style.display = 'none'; img.style.display = 'block'; };
    document.getElementById('guessInput').value = "";
    document.getElementById('guessInput').focus();
}

function sendGuess() {
    const val = document.getElementById('guessInput').value;
    if(isHost) validate(myName, val);
    else conn.send({type:'guess', name:myName, val:val});
}

function updateTimer(t) {
    document.getElementById('timerBar').style.width = (t/30)*100 + "%";
    document.getElementById('timeText').innerText = t + "s";
}

function sync() { broadcast({type:'sync', scores, idx:currentIdx}); }
function broadcast(d) { updateScores(); Object.values(peer.connections).forEach(conns => conns.forEach(c => c.send(d))); }

function updateScores() {
    document.getElementById('scoreList').innerHTML = Object.entries(scores)
        .sort((a,b) => b[1]-a[1]).map(([n,s]) => `<div class="score-item"><b>${n}</b>: ${s}</div>`).join('');
}

function winFlash() {
    document.body.classList.add('flash-win');
    setTimeout(() => document.body.classList.remove('flash-win'), 500);
}
</script>
</body>
</html>

